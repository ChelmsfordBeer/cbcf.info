jQuery(document).ready(function(e){var t="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",n=e(".csstransitions").length>0;function i(e){this.element=e,this.timeline=this.element.find(".timeline"),this.timelineItems=this.timeline.find("li"),this.timelineItemsNumber=this.timelineItems.length,this.timelineStart=l(this.timelineItems.eq(0).text()),this.timelineUnitDuration=l(this.timelineItems.eq(1).text())-l(this.timelineItems.eq(0).text()),this.eventsWrapper=this.element.find(".events"),this.eventsGroup=this.eventsWrapper.find(".events-group"),this.singleEvents=this.eventsGroup.find(".single-event"),this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.modal=this.element.find(".event-modal"),this.modalHeader=this.modal.find(".header"),this.modalHeaderBg=this.modal.find(".header-bg"),this.modalBody=this.modal.find(".body"),this.modalBodyBg=this.modal.find(".body-bg"),this.modalMaxWidth=800,this.modalMaxHeight=480,this.animating=!1,this.initSchedule()}n||(t="noTransition"),i.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents()},i.prototype.scheduleReset=function(){var e=this.mq();"desktop"!=e||this.element.hasClass("js-full")?"mobile"==e&&this.element.hasClass("js-full")?(this.element.removeClass("js-full loading"),this.eventsGroup.children("ul").add(this.singleEvents).removeAttr("style"),this.eventsWrapper.children(".grid-line").remove(),this.element.hasClass("modal-is-open")&&this.checkEventModal()):"desktop"==e&&this.element.hasClass("modal-is-open")?(this.checkEventModal("desktop"),this.element.removeClass("loading")):this.element.removeClass("loading"):(this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.element.addClass("js-full"),this.placeEvents(),this.element.hasClass("modal-is-open")&&this.checkEventModal())},i.prototype.initEvents=function(){var t=this;this.singleEvents.each(function(){var n='<span class="event-date">'+e(this).data("start")+" - "+e(this).data("end")+"</span>";e(this).children("a").prepend(e(n)),e(this).on("click","a",function(n){n.preventDefault(),t.animating||t.openModal(e(this))})}),this.modal.on("click",".close",function(e){e.preventDefault(),t.animating||t.closeModal(t.eventsGroup.find(".selected-event"))}),this.element.on("click",".cover-layer",function(e){!t.animating&&t.element.hasClass("modal-is-open")&&t.closeModal(t.eventsGroup.find(".selected-event"))})},i.prototype.placeEvents=function(){var t=this;this.singleEvents.each(function(){var n=l(e(this).attr("data-start")),i=l(e(this).attr("data-end"))-n,a=t.eventSlotHeight*(n-t.timelineStart)/t.timelineUnitDuration,o=t.eventSlotHeight*i/t.timelineUnitDuration;e(this).css({top:a-1+"px",height:o+1+"px"})}),this.element.removeClass("loading")},i.prototype.openModal=function(i){var a=this,o=a.mq();if(this.animating=!0,this.modalHeader.find(".event-name").text(i.find(".event-name").text()),this.modalHeader.find(".event-date").text(i.find(".event-date").text()),this.modal.attr("data-event",i.parent().attr("data-event")),this.modalBody.find(".event-info").load(i.parent().attr("data-content")+".html .event-info > *",function(e){a.element.addClass("content-loaded")}),this.element.addClass("modal-is-open"),setTimeout(function(){i.parent("li").addClass("selected-event")},10),"mobile"==o)a.modal.one(t,function(){a.modal.off(t),a.animating=!1});else{var s=i.offset().top-e(window).scrollTop(),d=i.offset().left,l=i.innerHeight(),r=i.innerWidth(),h=e(window).width(),c=e(window).height(),p=.8*h>a.modalMaxWidth?a.modalMaxWidth:.8*h,f=.8*c>a.modalMaxHeight?a.modalMaxHeight:.8*c,g=parseInt((h-p)/2-d),u=parseInt((c-f)/2-s),v=f/l,x=p-r;a.modal.css({top:s+"px",left:d+"px",height:f+"px",width:p+"px"}),m(a.modal,"translateY("+u+"px) translateX("+g+"px)"),a.modalHeader.css({width:r+"px"}),a.modalBody.css({marginLeft:r+"px"}),a.modalBodyBg.css({height:l+"px",width:"1px"}),m(a.modalBodyBg,"scaleY("+v+") scaleX("+x+")"),a.modalHeaderBg.css({height:l+"px",width:r+"px"}),m(a.modalHeaderBg,"scaleY("+v+")"),a.modalHeaderBg.one(t,function(){a.modalHeaderBg.off(t),a.animating=!1,a.element.addClass("animation-completed")})}n||a.modal.add(a.modalHeaderBg).trigger(t)},i.prototype.closeModal=function(i){var a=this,o=a.mq();if(this.animating=!0,"mobile"==o)this.element.removeClass("modal-is-open"),this.modal.one(t,function(){a.modal.off(t),a.animating=!1,a.element.removeClass("content-loaded"),i.removeClass("selected-event")});else{var s=i.offset().top-e(window).scrollTop(),d=i.offset().left,l=i.innerHeight(),r=i.innerWidth(),h=Number(a.modal.css("top").replace("px","")),c=d-Number(a.modal.css("left").replace("px","")),p=s-h;a.element.removeClass("animation-completed modal-is-open"),this.modal.css({width:r+"px",height:l+"px"}),m(a.modal,"translateX("+c+"px) translateY("+p+"px)"),m(a.modalBodyBg,"scaleX(0) scaleY(1)"),m(a.modalHeaderBg,"scaleY(1)"),this.modalHeaderBg.one(t,function(){a.modalHeaderBg.off(t),a.modal.addClass("no-transition"),setTimeout(function(){a.modal.add(a.modalHeader).add(a.modalBody).add(a.modalHeaderBg).add(a.modalBodyBg).attr("style","")},10),setTimeout(function(){a.modal.removeClass("no-transition")},20),a.animating=!1,a.element.removeClass("content-loaded"),i.removeClass("selected-event")})}n||a.modal.add(a.modalHeaderBg).trigger(t)},i.prototype.mq=function(){return window.getComputedStyle(this.element.get(0),"::before").getPropertyValue("content").replace(/["']/g,"")},i.prototype.checkEventModal=function(t){this.animating=!0;var n=this,i=this.mq();if("mobile"==i)n.modal.add(n.modalHeader).add(n.modalHeaderBg).add(n.modalBody).add(n.modalBodyBg).attr("style",""),n.modal.removeClass("no-transition"),n.animating=!1;else if("desktop"==i&&n.element.hasClass("modal-is-open")){n.modal.addClass("no-transition"),n.element.addClass("animation-completed");var a=n.eventsGroup.find(".selected-event"),o=(a.offset().top,e(window).scrollTop(),a.offset().left,a.innerHeight()),s=a.innerWidth(),d=e(window).width(),l=e(window).height(),r=.8*d>n.modalMaxWidth?n.modalMaxWidth:.8*d,h=.8*l>n.modalMaxHeight?n.modalMaxHeight:.8*l,c=h/o,p=r-s;setTimeout(function(){n.modal.css({width:r+"px",height:h+"px",top:l/2-h/2+"px",left:d/2-r/2+"px"}),m(n.modal,"translateY(0) translateX(0)"),n.modalBodyBg.css({height:h+"px",width:"1px"}),m(n.modalBodyBg,"scaleX("+p+")"),n.modalHeader.css({width:s+"px"}),n.modalBody.css({marginLeft:s+"px"}),n.modalHeaderBg.css({height:o+"px",width:s+"px"}),m(n.modalHeaderBg,"scaleY("+c+")")},10),setTimeout(function(){n.modal.removeClass("no-transition"),n.animating=!1},20)}};var a=e(".cd-schedule"),o=[],s=!1;function d(){o.forEach(function(e){e.scheduleReset()}),s=!1}function l(e){var t=(e=e.replace(/ /g,"")).split(":");return 60*parseInt(t[0])+parseInt(t[1])}function m(e,t){e.css({"-moz-transform":t,"-webkit-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}a.length>0&&a.each(function(){o.push(new i(e(this)))}),e(window).on("resize",function(){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(d):setTimeout(d))}),e(window).keyup(function(e){27==e.keyCode&&o.forEach(function(e){e.closeModal(e.eventsGroup.find(".selected-event"))})})});